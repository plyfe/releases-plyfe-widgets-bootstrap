/*!
 * Plyfe Widgets Library v1.5.0
 * http://plyfe.com/
 *
 * Copyright 2015, Plyfe Inc.
 *
 * Available via the MIT license.
 * http://github.com/plyfe/plyfe-widgets-bootstrap/LICENSE
 *
 * Date: 2015-09-11
 */
!function(a,b){a.Plyfe||(a.Plyfe=b())}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../node_modules/almond/almond",function(){}),c("utils",["require"],function(a){"use strict";function b(a,b,c){return a.getAttribute("data-"+b)||c}function c(a){var b=[];return e(a||{},function(c){var d=a[c];if(d!==r){var e=encodeURIComponent(j(c));null!==d&&(e+="="+encodeURIComponent(d)),b.push(e)}}),b.join("&")}function d(a,b,d,e,f){switch(a){case"http":d=d&&80!==d?":"+d:"";break;case"https":d=d&&443!==d?":"+d:""}var g=a+"://"+(b||"")+d,h=c(f);return g+=(e?"/"+e:"").replace(/\/{2,}/g,"/"),g+=(h?"?":"")+h}function e(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=b(c,a[c]);if(null===d)return}}function f(a){if(!(a&&"readystatechange"===a.type&&"complete"!==document.readyState||x)){x=!0,v(window,"load",f),v(document,"readystatechange",f),v(document,"DOMContentLoaded",f);for(var b=0;b<w.length;b++)w[b]()}}function g(a){x?a():w.push(a)}function h(a,b){e(b,function(b,c){null!==c&&c!==r&&(a.style[b]="number"==typeof c?c+"px":c)})}function i(a){return(a+"").replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function j(a){return(a+"").replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()})}function k(a,b){b=b||{};var c=document.createElement("style");return c.type="text/css",c.media="screen",b.id&&(c.id=b.id),c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),s.insertBefore(c,s.firstChild),c}function l(a){var b=z[a];if(b)return b;for(var c in y)if(y.hasOwnProperty(c)){var d=y[c],e=i(c+a);if("string"==typeof A.style[e]){var f=d+a;return z[a]=f,f}}return a}function m(a,b){return l(a)+": "+b+";"}function n(a){return a.replace(/^\s+|\s+$/g,"")}function o(a,b){for(var c=n(a.className).split(/\s+/),d=c.length-1;d>=0;d--){var e=c[d];if(e===b)return}c.push(n(b+"")),a.className=c.join(" ")}function p(a){this.name="PlyfeError",this.message=a||""}function q(a,b){var c={};for(var d in b||{})c[d]=b[d];for(var e in a||{})c[e]=a[e];return c}var r,s=document.getElementsByTagName("head")[0],t=!1;window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&(t=!0);var u=function(a,b,c){a.addEventListener(b,c,!1)};window.attachEvent&&(u=function(a,b,c){var d=c.__attachEventRef=function(){var a=window.event;a.keyCode=a.which,c(a)};a.attachEvent("on"+b,d)});var v=function(a,b,c){a.removeEventListener(b,c,!1)};window.detachEvent&&(v=function(a,b,c){a.detachEvent("on"+b,c.__attachEventRef)});var w=[],x=!1;"complete"===document.readyState?f():(u(window,"load",f),u(document,"readystatechange",f),u(document,"DOMContentLoaded",f));var y={"":"","Moz-":"-moz-","webkit-":"-webkit-","Webkit-":"-webkit-","Khtml-":"-khtml-","O-":"-o-","ms-":"-ms-"},z={},A=document.createElement("div");return p.prototype=Error.prototype,{head:s,dataAttr:b,buildQueryString:c,buildUrl:d,isCorsSupported:t,objForEach:e,addEvent:u,removeEvent:v,domReady:g,setStyles:h,dashedToCamel:i,camelToDashed:j,customStyleSheet:k,cssRule:m,trim:n,addClass:o,PlyfeError:p,objectMerge:q}}),c("settings",["require"],function(a){"use strict";return{env:"production",scheme:"https",domain:"plyfe.me",port:443,selector:".plyfe-widget"}}),c("env",["require"],function(a){"use strict";return{production:{domain:"plyfe.me",port:443},staging:{domain:"staging.plyfe.me",port:443},demo:{domain:"demo.plyfe.me",port:443},test:{domain:"test.plyfe.me",port:443},development:{domain:"development.plyfe.me",port:3001}}}),c("switchboard",["require","utils"],function(a){"use strict";function b(a,b,c){if(!b)throw new TypeError("Argument name required");c.postMessage(j+b+"\n"+JSON.stringify(a),k)}function c(a){if(window.JSON){var b=a.data;if("string"==typeof b){var c=b.substr(0,j.length)===j;if(c){var d=b.indexOf("\n",j.length),f=b.substring(j.length,d),g=JSON.parse(b.substr(d+1));e(g,f,a.source)}}}}function d(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];a=a.concat(l[c]||[])}return a}function e(a,b,c){for(var e=b.split(":"),f=d(b,l[e[0]+":*"],"*"),g=0;g<f.length;g++)f[g](a,b,c);0===f.length&&console.warn("Switchboard recieved a unhandled '"+b+"' message",a)}function f(a,b){if("function"!=typeof b)throw new TypeError("second argument must be a function");var c=l[a]=l[a]||[];c.push(b)}function g(a,b){if(b)for(var c=l[a]||[],d=c.length-1;d>=0;d--)c[d]===b&&c.splice(d,1);else delete l[a]}function h(){i.addEvent(window,"message",c)}var i=a("utils"),j="plyfe:",k="*",l={};return{setup:h,send:b,on:f,off:g,events:l}}),c("widget",["require","utils","settings","env","switchboard"],function(a){"use strict";function b(a){for(var b=l.length-1;b>=0;b--){var c=l[b];if(c.iframe.contentWindow===a)return c}}function c(a,b,c){for(var d="broadcast:",e=0;e<l.length;e++){var f=l[e];if(f.iframe.contentWindow!==c){var g=b.substr(d.length);k.send(a,g,f.iframe.contentWindow)}}}function d(a){throw new h.PlyfeError("data-"+a+" attribute required")}function e(a){this.el=a,this.slot=h.dataAttr(a,"slot");var b=[],c={},e=h.dataAttr(a,"scheme",i.scheme);this.slot?b=["s",this.slot]:(this.type=h.dataAttr(a,"type"),this.id=h.dataAttr(a,"id"),this.type||d("type"),this.id||d("id"),b=["w",this.type,this.id]),h.dataAttr(a,"transparent-bg")&&(c.transparent="true");var f=i.domain,g=i.port,k=h.dataAttr(a,"env");k&&(f=j[k].domain,g=j[k].port),f=h.dataAttr(a,"domain",f),g=h.dataAttr(a,"port",g);var l=h.dataAttr(a,"custom-id");l&&(c.custom_id=l);var n=h.dataAttr(a,"click-tracker-id");n&&(c.click_tracker_id=n);var o=h.buildUrl(e,f,g,b.join("/"),c),p="plyfe-"+ ++m,q=document.createElement("iframe");q.name=p,q.src=o,q.scrolling="no",q.frameBorder="0",q.allowTransparency="true",this.el.innerHTML="",this.el.appendChild(q),this.iframe=q}function f(a){if(!a&&3===a.nodeType)throw new h.PlyfeError("createWidget() must be called with a DOM element");(null===a.firstChild||"iframe"!==a.firstChild.nodeName)&&l.push(new e(a))}function g(a){if("iframe"!==a.nodeName&&(a=a.firstChild),a&&"iframe"===a.nodeName)for(var b=l.length-1;b>=0;b--){var c=l[b];c.iframe===a&&(l.splice(b,1),a.parentNode.innerHTML="")}}var h=a("utils"),i=a("settings"),j=a("env"),k=a("switchboard"),l=[],m=0,n=".plyfe-widget {height: 0;opacity: 0;overflow-x: hidden;"+h.cssRule("transition","opacity 300ms")+"}\n.plyfe-widget.ready {opacity: 1;}\n.plyfe-widget iframe {display: block;width: 100%;height: 100%;border-width: 0;overflow: hidden;}";return h.customStyleSheet(n,{id:"plyfe-widget-css"}),e.prototype.ready=function(a){h.setStyles(this.el,{minWidth:a.minWidth,maxWidth:a.maxWidth,height:a.height,minHeight:a.minHeight}),h.addClass(this.el,"ready")},k.on("broadcast:*",c),k.on("load",function(a,c,d){b(d).ready(a)}),k.on("height",function(a,c,d){h.setStyles(b(d).el,{height:a})}),{create:f,distroy:g,list:l}}),c("main",["require","utils","settings","widget","switchboard","env"],function(a){"use strict";function b(){for(var a=document.querySelectorAll(g.selector),b=0;b<a.length;b++)h.create(a[b])}function c(a){return h.create(a)}function d(a,b){var c=f.objectMerge(a.user,{id:0}),d=f.objectMerge(a.card,{id:0,type:"no_type"});s["onCard"+b].call(s,d,c)}function e(a,b){var c=f.objectMerge(a.user,{id:0}),d=f.objectMerge(a.card,{id:0,type:"no_type"}),e=f.objectMerge(a.choice,{id:0,name:"no_name",correct:null});s["onChoice"+b].call(s,d,c,e)}var f=a("utils"),g=a("settings"),h=a("widget"),i=a("switchboard"),j=a("env");i.setup();for(var k="plyfeAsyncInit",l=document.getElementsByTagName("script"),m=l.length-1;m>=0;m--){var n=l[m];if(/\/plyfe-widgets-bootstrap.*?\.js(\?|#|$)/.test(n.src)){g.scheme=f.dataAttr(n,"scheme",g.scheme),g.env=f.dataAttr(n,"env",g.env);var o=j[g.env]||j.production;g.domain=o.domain,g.port=o.port,g.domain=f.dataAttr(n,"domain",g.domain),g.port=+f.dataAttr(n,"port")||g.port,k=f.dataAttr(n,"init-name",k);break}}f.domReady(function(){window[k]&&"function"==typeof window[k]?setTimeout(window[k],0):b()}),i.on("card:start",function(a){d(a,"Start")}),i.on("card:complete",function(a){d(a,"Complete")}),i.on("choice:selection",function(a){e(a,"Selection")});var p=window.Plyfe&&window.Plyfe.onCardStart||function(){},q=window.Plyfe&&window.Plyfe.onCardComplete||function(){},r=window.Plyfe&&window.Plyfe.onChoiceSelection||function(){},s={settings:g,createWidgets:b,createWidget:c,onCardStart:p,onCardComplete:q,onChoiceSelection:r};return s}),b("main")});