/*!
 * Plyfe Widgets Library v0.3.3
 * http://plyfe.com/
 *
 * Copyright 2014, Plyfe Inc.
 *
 * Available via the MIT license.
 * http://github.com/plyfe/plyfe-widgets-bootstrap/LICENSE
 *
 * Date: 2014-08-28
 */
!function(a,b){if("function"==typeof define&&define.amd)define([],b);else{if(a.Plyfe)return;a.Plyfe={amd:!1},a.Plyfe=b()}}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../node_modules/almond/almond",function(){}),c("utils",["require"],function(){function a(a,b,c){return a.getAttribute("data-"+b)||c}function b(a){var b=[];return d(a||{},function(c){var d=a[c];if(d!==q){var e=encodeURIComponent(i(c));null!==d&&(e+="="+encodeURIComponent(d)),b.push(e)}}),b.join("&")}function c(a,c,d,e,f){switch(a){case"http":d=d&&80!==d?":"+d:"";break;case"https":d=d&&443!==d?":"+d:""}var g=a+"://"+(c||"")+d,h=b(f);return g+=(e?"/"+e:"").replace(/\/{2,}/g,"/"),g+=(h?"?":"")+h}function d(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=b(c,a[c]);if(null===d)return}}function e(a){if(!(a&&"readystatechange"===a.type&&"complete"!==document.readyState||w)){w=!0,u(window,"load",e),u(document,"readystatechange",e),u(document,"DOMContentLoaded",e);for(var b=0;b<v.length;b++)v[b]()}}function f(a){w?a():v.push(a)}function g(a,b){d(b,function(b,c){a.style[b]="number"==typeof c?c+"px":c})}function h(a){return(a+"").replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function i(a){return(a+"").replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()})}function j(a,b){b=b||{};var c=document.createElement("style");return c.type="text/css",c.media="screen",b.id&&(c.id=b.id),c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),r.insertBefore(c,r.firstChild),c}function k(a){var b=y[a];return b?b:void d(x,function(b,c){var d=h(b+a);if("string"==typeof z.style[d]){var e=c+a;return y[a]=e,e}})}function l(a,b){return k(a)+": "+b+";"}function m(a){a=+a||0;for(var b="";b.length<a;)b+=Math.random().toString(36).substring(2);return b.substr(0,a)}function n(a){return a.replace(/^\s+|\s+$/g,"")}function o(a,b){for(var c=n(a.className).split(/\s+/),d=c.length-1;d>=0;d--){var e=c[d];if(e===b)return}c.push(n(b+"")),a.className=c.join(" ")}function p(a){this.name="PlyfeError",this.message=a||""}var q,r=document.getElementsByTagName("head")[0],s=!1;window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&(s=!0);var t=function(a,b,c){a.addEventListener(b,c,!1)};window.attachEvent&&(t=function(a,b,c){var d=c.__attachEventRef=function(){var a=window.event;a.keyCode=a.which,c(a)};a.attachEvent("on"+b,d)});var u=function(a,b,c){a.removeEventListener(b,c,!1)};window.detachEvent&&(u=function(a,b,c){a.detachEvent("on"+b,c.__attachEventRef)});var v=[],w=!1;"complete"===document.readyState?e():(t(window,"load",e),t(document,"readystatechange",e),t(document,"DOMContentLoaded",e));var x={"":"","Moz-":"-moz-","webkit-":"-webkit-","Webkit-":"-webkit-","Khtml-":"-khtml-","O-":"-o-","ms-":"-ms-"},y={},z=document.createElement("div");return p.prototype=Error.prototype,{head:r,dataAttr:a,buildQueryString:b,buildUrl:c,isCorsSupported:s,objForEach:d,addEvent:t,removeEvent:u,domReady:f,setStyles:g,dashedToCamel:h,camelToDashed:i,customStyleSheet:j,cssRule:l,uniqueString:m,trim:n,addClass:o,PlyfeError:p}}),c("settings",["require"],function(){return{scheme:"https",domain:"plyfe.me",port:443,authToken:null,selector:".plyfe-widget",theme:null}}),c("widget",["require","utils","settings"],function(a){function b(a){throw new g.PlyfeError("data-"+a+" attribute required")}function c(a){function c(){clearTimeout(q),g.addClass(a,"ready")}this.el=a,this.venue=g.dataAttr(a,"venue"),this.type=g.dataAttr(a,"type"),this.id=g.dataAttr(a,"id"),this.venue||b("venue"),this.type||b("type"),this.id||b("id");var d=g.dataAttr(a,"scheme",h.scheme),e=g.dataAttr(a,"domain",h.domain),f=g.dataAttr(a,"port",h.port),i=+g.dataAttr(a,"height");i||b("height");var l=["w",this.venue,this.type,this.id],m={theme:g.dataAttr(a,"theme",h.theme),theme_data:g.dataAttr(a,"theme-overrides"),treatment:g.dataAttr(a,"treatment"),height:i};g.dataAttr(a,"transparent-bg")&&(m.transparent="true");var n=g.buildUrl(d,e,f,l.join("/"),m),o="plyfe-"+ ++j,p=document.createElement("iframe");p.onload=c,p.name=o,p.src=n,p.scrolling="no",p.frameBorder="0",p.allowTransparency="true",g.setStyles(p,{height:i}),this.el.innerHTML="",this.el.appendChild(p),this.iframe=p;var q=setTimeout(c,k)}function d(a){if(!a&&3===a.nodeType)throw new g.PlyfeError("createWidget() must be called with a DOM element");(null===a.firstChild||"iframe"!==a.firstChild.nodeName)&&i.push(new c(a))}function e(a){if("iframe"!==a.nodeName&&(a=a.firstChild),a&&"iframe"===a.nodeName)for(var b=i.length-1;b>=0;b--){var c=i[b];c.iframe===a&&(i.splice(b,1),a.parentNode.innerHTML="")}}function f(a){for(var b=i.length-1;b>=0;b--)a(i[b])}var g=a("utils"),h=a("settings"),i=[],j=0,k=5e3,l=".plyfe-widget {opacity: 0;overflow-x: hidden;"+g.cssRule("transition","opacity 300ms")+"}\n.plyfe-widget.ready {opacity: 1;}\n.plyfe-widget iframe {display: block;width: 100%;height: 100%;border-width: 0;overflow: hidden;}";return g.customStyleSheet(l,{id:"plyfe-widget-css"}),{create:d,distroy:e,list:i,forEach:f}}),c("api",["require","utils","settings"],function(a){function b(){}function c(a){return i.buildUrl(j.scheme,j.domain,j.port,"/api/"+a)}function d(a,d,f,g){g=g||{};var h=g.onSuccess||b,j=g.onError||b;a=a.toUpperCase();var k=c(d),l=i.isCorsSupported?new XMLHttpRequest:new e;return l.onreadystatechange=function(){if(4===l.readyState){var a=JSON.parse(l.responseText||""),b=l.status;0===b?j({message:"Request "+k+" returned an invalid HTTP status of 0."},0):b>=200&&400>b?h(a,b):b>=400&&j(a,b)}},"GET"===a&&f&&(k+=(k.indexOf("?")>=0?"&":"?")+i.buildQueryString(f)),l.open(a,k),g.withCredentials&&(l.withCredentials=!0),"POST"===a&&f&&(l.setRequestHeader("Content-Type","application/json"),f=JSON.stringify(f)),l.send(f?f:null),l}function e(a){this.el=document.createElement("script"),this.uniqueCallbackName=a||"plyfeJsonPCallback_"+i.uniqueString(10)}function f(a,b,c){return d.call(null,"get",a,b,c)}function g(a,b,c){return d.call(null,"post",a,b,c)}var h,i=a("utils"),j=a("settings");return e.prototype.setRequestHeader=function(){},e.prototype.open=function(a,b){this.method=a,this.url=b},e.prototype.send=function(a){var b=this;window[this.uniqueCallbackName]=function(a){try{delete window[b.uniqueCallbackName]}catch(c){window[b.uniqueCallbackName]=h}b.responseText=a,b.readyState=4,b.status=a.http_status_code||200,b.onreadystatechange()};var c={callback:this.uniqueCallbackName,http_method:this.method.toUpperCase()};a&&(c.http_data=a),this.el.src=this.url+"?"+i.buildQueryString(c)+"&"+a,i.head.appendChild(this.el),setTimeout(function(){try{i.head.removeChild(b.el)}catch(a){}},200)},{get:f,post:g,JSONPRequest:e,buildApiUrl:c}}),c("auth",["require","utils","settings","api"],function(a){function b(a,b){if(!d.authToken)throw new c.PlyfeError("A authToken must be set before login.");if(f)throw new c.PlyfeError("login() can only be called once");f=!0;var g={};a&&(g.onSuccess=a),b&&(g.onError=b);var h={auth_token:d.authToken};e.post("/external_sessions",h,g)}var c=a("utils"),d=a("settings"),e=a("api"),f=!1;return{logIn:b}}),c("switchboard",["require","utils","widget"],function(a){function b(a,b,c){if(!b)throw new TypeError("Argument name required");a.postMessage(i+b+"\n"+JSON.stringify(c),j)}function c(a){if(window.JSON){var b=a.data,c=b.substr(0,i.length)===i;if(c){var e=b.indexOf("\n",i.length),f=b.substring(i.length,e),g=JSON.parse(b.substr(e+1));d(f,g,a.source)}}}function d(a,b,c){var d=a.split(":");switch(d[0]){case"broadcast":e(d.slice(1).join(":"),b,c);break;case"sizechanged":break;default:console.warn("Switchboard recieved a unhandled '"+a+"' message",b)}}function e(a,c,d){h.forEach(function(e){e.iframe.contentWindow!==d&&b(e.iframe.contentWindow,a,c)})}function f(){g.addEvent(window,"message",c)}var g=a("utils"),h=a("widget"),i="plyfe:",j="*";return{setup:f,postMessage:b}}),c("main",["require","utils","settings","widget","auth","switchboard"],function(a){function b(){for(var a=document.querySelectorAll(e.selector),b=0;b<a.length;b++)f.create(a[b])}function c(a){return f.create(a)}var d=a("utils"),e=a("settings"),f=a("widget"),g=a("auth"),h=a("switchboard");h.setup();for(var i="plyfeAsyncInit",j=!window.Plyfe||window.Plyfe.amd!==!1,k=document.getElementsByTagName("script"),l=k.length-1;l>=0;l--){var m=k[l];if(/\/plyfe-widgets-bootstrap.*?\.js(\?|#|$)/.test(m.src)){e.authToken=d.dataAttr(m,"auth-token",null),e.scheme=d.dataAttr(m,"scheme",e.scheme),e.domain=d.dataAttr(m,"domain",e.domain),e.port=+d.dataAttr(m,"port")||e.port,e.theme=d.dataAttr(m,"theme"),i=d.dataAttr(m,"init-name",i);break}}return j||d.domReady(function(){window[i]&&"function"==typeof window[i]?setTimeout(window[i],0):e.authToken?g.logIn(function(){b()}):b()}),{settings:e,createWidgets:b,createWidget:c,logIn:g.logIn}}),b("main")});